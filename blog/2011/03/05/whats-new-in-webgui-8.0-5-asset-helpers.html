<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.1.1/css/bootstrap.min.css" />
        <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.1.1/css/bootstrap-theme.min.css" />
        <script src="http://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.1.1/js/bootstrap.min.js"></script>
        <title>preaction</title>
        <style type="text/css">
            main header h1
            {
                border-bottom: 4px solid #045578;
            }
            header aside {
                margin-top: 0;
                font-size: 12pt;
            }
            .sidebar h1 {
                font-size: 14pt;
            }

            /** Add a line when using the "Continue reading..." link */
            section:target {
                padding-top: 0.5em;
                border-top: 4px solid #045578;
            }

            /** Don't allow <pre> to push too much */
            pre {
                max-width: 100%;
                overflow-x: scroll;
            }

            /** <code> is used for input and output, so let it wrap */
            code {
                white-space: normal;
            }

            .tags {
                float: right;
            }

            /**
             * Don't allow main content images to push things around
             */
            main img {
                max-width: 100%;
            }

            footer .tagline {
                font-size: smaller;
                line-height: 1.3;
                text-align: right;
            }

        </style>
        
    </head>
    <body>
        <header>
            <nav class="navbar navbar-default navbar-static-top" role="navigation">
                <div class="container">
                <!-- Brand and toggle get grouped for better mobile display -->
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#top-navbar-collapse-1">
                            <span class="sr-only">Toggle navigation</span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                        <a class="navbar-brand" href="/">preaction</a>
                    </div>
                    <!-- Collect the nav links, forms, and other content for toggling -->
                    <div class="collapse navbar-collapse" id="top-navbar-collapse-1">
                        <ul class="nav navbar-nav">
                            <li><a href="/index.html">Blog</a></li>
                            <li><a href="/Statocles">Statocles</a></li>
                            <li><a href="/presentations.html">Presentations</a></li>
                        </ul>
                    </div>
                </div>
            </nav>
            
        </header>
        <div class="main container">
            <div class="row">

    <div class="col-md-9">
        <main>
            <header>
                <h1>What's New in WebGUI 8.0 #5 - Asset Helpers</h1>
                <p class="tags">Tags:
                    <a href="/blog/tag/webgui/index.html" rel="tag">webgui</a>
                </p>
                <aside>
                    <p><time datetime="2011-03-05">
                        Posted on 2011-03-05
                    </time>
                    by preaction</p>
                </aside>
                <div class="alert alert-info">
                    <p>Originally posted as:</p>
                    <ul>
                        <li><a class="alert-link" href="http://blogs.perl.org/users/preaction/2011/03/whats-new-in-webgui-80-5---asset-helpers.html">
                            <em>What's New in WebGUI 8.0 #5 - Asset Helpers</em> on blogs.perl.org.
                        </a></li>
                    </ul>
                </div>
            </header>
            <section id="section-1">
                <p>By far the biggest change we've made in WebGUI 8 is the new Admin Console.
Though parts of it may look familiar, it has been completely rewritten from
the ground up to be a flexible, extensible, responsive JavaScript application
making calls to JSON services in Perl.</p>

<p>I could talk about how to use the admin interface, but I don't think that's
why you would read this blog, so instead I'm going to talk about how you can add functionality to it.</p>

            </section>
            <section id="section-2">
                <h2>Asset Services</h2>

<p>Since Assets are the basic unit of both application and content in WebGUI,
much of the Admin Console is spent interacting with Assets. It does so by
calling out to Asset Helpers.</p>

<p>By default, every asset has a helper to Cut, Copy, Duplicate, Delete, and
more. When a helper gets called, it returns a JSON data structure explaining
to the Admin Console what to do next.</p>

<p>We can simply show the user a message:</p>

<pre><code>message     =&gt; 'The work is done, here's what happened.'
error       =&gt; 'Something went wrong.'
</code></pre>

<p>Or we can open up new dialogs or tabs to allow the user to give us more data:</p>

<pre><code>openDialog  =&gt; '/helper/get_input'
openTab     =&gt; '/helper/get_input'
</code></pre>

<p>We can let the user know their command is running in a forked process:</p>

<pre><code>forkId      =&gt; '...' # GUID for WebGUI::Fork object
</code></pre>

<p>We can even load and run any external JS file:</p>

<pre><code>scriptFile  =&gt; '/extras/newscript.js',  # Load a new script file
scriptFunc  =&gt; 'myFunction',            # Call a function in that script
scriptArgs  =&gt; [ "arg1", "arg2", ],     # Pass some arguments to that func
</code></pre>

<p>To write an Asset Helper, we inherit from WebGUI::AssetHelper and override the
process() method to send back one of the message types from above.</p>

<pre><code>package MyHelper;
use base 'WebGUI::AssetHelper';

sub process {
    my ( $self ) = @_;

    return { error =&gt; 'Cry Havoc!' } if !$self-&gt;asset-&gt;canEdit;

    # Do some work

    return { message =&gt; 'Work is done!' };
}
</code></pre>

<p>If our Asset Helper needs to get some input from the user, we can open a
dialog. Like most everything in WebGUI, Asset Helpers can also have www_
methods.</p>

<pre><code>package MyFormHelper;
use base 'WebGUI::AssetHelper';

sub process {
    my ( $self ) = @_;
    my $url = $self-&gt;getUrl( "showForm" );
    return { openDialog =&gt; $url };
}

sub www_showForm {
    my ( $self ) = @_;
    my $form    = $self-&gt;getForm( 'processForm' ); # WebGUI::FormBuilder
    $form-&gt;addField( "text", name =&gt; 'why' );
    return $form-&gt;toHtml;
}

sub www_processForm {
    my ( $self ) = @_;
    my $input = $self-&gt;session-&gt;form-&gt;get( 'why' ); # input from the form
    return { message =&gt; $input }; # Why not?
}
</code></pre>

<p>But our asset helpers are not only useful inside of the Admin Console. Because
they're all built on a simple JSON API, you can call them from anywhere. For
example, the Asset Helper to resize and rotate images could be used by anyone
with edit privileges to the Image.</p>

<p>Because we already have these Asset Helpers, the new Asset Manager (now called 
the Tree view) uses them to perform all of its tasks. This means, again, more
code reuse and less code in WebGUI.</p>

<p>Side note: I love deleting code much more than writing it.</p>

<h2>Adding Helpers</h2>

<p>What would a plugin point be without a way to override what already exists? In
our case, if you want another helper to handle the "cut" operation, you can
make it happen.</p>

<p>If you have your own asset, you can override the getHelpers method, which
returns a hashref of helper descriptions:</p>

<pre><code>package MyAsset;

around getHelpers =&gt; sub {
    my ( $orig, $self ) = @_;
    my $helpers = $self-&gt;$orig;
    $helpers-&gt;{ "cut" } = {
        className   =&gt; 'MyCutHelper',
        label       =&gt; 'SuperCuts',
    };
    return $helpers;
};
</code></pre>

<p>Or if you don't want to edit the asset's code, you could add your helpers to
the configuration file:</p>

<pre><code>{
    "assets" : {
        "WebGUI::Asset::Snippet" : {
            "helpers" : {
                "cut" : {
                    "className" : "MyCutHelper",
                    "label"     : "SuperCuts"
                }
            }
        }
    }
}
</code></pre>

<p>Side Note: Deep data-structure is deep.</p>

<p>A Helper doesn't have to be its own class, it could be any URL at all:</p>

<pre><code>$helpers-&gt;{ "edit" } = {
    url     =&gt; './edit',
    label   =&gt; 'Edit',
};
</code></pre>

<p>So Asset Helpers are the new way to add related tasks to your assets. Come
back next time when I introduce WebGUI::FormBuilder.</p>

            </section>
        </main>
    </div>

    <div class="col-md-3">
        
        <nav id="tags">
            <h1>Tags</h1>
            <ul class="list-inline">
                <li><a href="/blog/tag/chicago.pm/index.html">chicago.pm</a></li>
                <li><a href="/blog/tag/error/index.html">error</a></li>
                <li><a href="/blog/tag/food/index.html">food</a></li>
                <li><a href="/blog/tag/funny/index.html">funny</a></li>
                <li><a href="/blog/tag/git/index.html">git</a></li>
                <li><a href="/blog/tag/moose/index.html">moose</a></li>
                <li><a href="/blog/tag/mysql/index.html">mysql</a></li>
                <li><a href="/blog/tag/openbsd/index.html">openbsd</a></li>
                <li><a href="/blog/tag/perl/index.html">perl</a></li>
                <li><a href="/blog/tag/personal/index.html">personal</a></li>
                <li><a href="/blog/tag/progress/index.html">progress</a></li>
                <li><a href="/blog/tag/rants/index.html">rants</a></li>
                <li><a href="/blog/tag/scripts/index.html">scripts</a></li>
                <li><a href="/blog/tag/software/index.html">software</a></li>
                <li><a href="/blog/tag/webgui/index.html">webgui</a></li>
                <li><a href="/blog/tag/xs/index.html">xs</a></li>
            </ul>
        </nav>
    </div>

</div>

        </div>
        <footer>
            
            <div class="container tagline">
                <a href="http://preaction.github.io/Statocles">Made with Statocles</a><br/>
                <a href="http://www.perl.org">Powered by Perl</a>
            </div>
        </footer>
    </body>
</html>
