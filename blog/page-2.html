<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.1.1/css/bootstrap.min.css" />
        <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.1.1/css/bootstrap-theme.min.css" />
        <script src="http://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.1.1/js/bootstrap.min.js"></script>
        <title>Doug Bell</title>
        <style type="text/css">
            article > hgroup > h1,
            main > hgroup > h1
            {
                border-bottom: 4px solid #045578;
            }
            header aside {
                margin-top: 0;
                font-size: 12pt;
            }
            nav#tags h1 {
                font-size: 14pt;
            }
        </style>
            <link rel="alternate" href="/blog/index.atom" type="application/atom+xml" />
            <link rel="alternate" href="/blog/index.rss" type="application/rss+xml" />
    </head>
    <body>
        <header>
            <nav class="navbar navbar-default navbar-static-top" role="navigation">
                <div class="container">
                <!-- Brand and toggle get grouped for better mobile display -->
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#top-navbar-collapse-1">
                            <span class="sr-only">Toggle navigation</span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                        <a class="navbar-brand" href="/">Doug Bell</a>
                    </div>
                    <!-- Collect the nav links, forms, and other content for toggling -->
                    <div class="collapse navbar-collapse" id="top-navbar-collapse-1">
                        <ul class="nav navbar-nav">
                            <li><a href="/index.html">Blog</a></li>
                            <li><a href="/presentations.html">Presentations</a></li>
                        </ul>
                    </div>
                </div>
            </nav>
        </header>
        <div class="main container">
            
<div class="row">

    <div class="col-md-9">
        <main>
            <article>
                <header>
                    <h1><a href="/blog/2013/03/29/chicago.pm-dependency-injection-also-beam-wire.html">Chicago.PM - Dependency Injection (also: Beam::Wire)</a></h1>
                    <aside>
                        <p><time datetime="2013-03-29">
                            Posted on 2013-03-29
                        </time>
                        by preaction</p>
                    </aside>
                    <div class="alert alert-info">
                        <p>Originally posted as:</p>
                        <ul>
                            <li><a class="alert-link" href="http://blogs.perl.org/users/preaction/2013/03/chicagopm---dependency-injection-also-beamwire.html">
                                <em>Chicago.PM - Dependency Injection (also: Beam::Wire)</em> on blogs.perl.org.
                            </a></li>
                        </ul>
                    </div>
                </header>
                <p>At <a href="http://www.meetup.com/Windy-City-Perl-mongers-Meetup/events/104681992/">this month's Chicago.PM
meeting</a>,
I gave <a href="http://preaction.github.com/Perl/Dependency-Injection.html">a presentation on Dependency Injection and my new module,
Beam::Wire</a>.</p>

<p>[EDIT: The presentation doesn't appear to work on mobile devices. I'm trying
deck.js, and I'm not sure I like it.]</p>

<hr />

<p>When I started my current job, I was introduced to the custom Dependency
Injection framework they built. At the time, I was dismissive: "It's
programming via config file, which is always limiting (and so, a Bad
Idea)." "It's something that Java needs, but not Perl."</p>

<p>Slowly, and with great reluctance, I learned where dependency injection fits
into a large framework: It removes the work of creating objects. Any object.
Anywhere.</p>

<p>For an idea of how powerful this is, do a quick search through your libraries
and scripts (except for tests) for /->new/. Hopefully, the results will only be
defaults (otherwise you've got tight coupling, another problem DI can fix). But
every time you call an object constructor is another place where dependency
injection can reduce the amount of code you write and maintain.</p>

<p>So, since the bureaucracy means I can't simply open-source the DI framework we
have at $dayjob, I decided to make my own.</p>

<p><a href="http://metacpan.org/modules/Beam::Wire">Beam::Wire</a> is <a href="http://search.cpan.org/~preaction/Beam-Wire/">available on
CPAN</a>. There are a lot of
features planned for it, so stay tuned! If you're interested, <a href="http://play-perl.org/quest/5130110d20d03f841200005b">up-vote
Beam::Wire on play-perl</a>.</p>

            </article>
            <article>
                <header>
                    <h1><a href="/blog/2013/03/14/chicago.pm-mojolicious.html">Chicago.PM - Mojolicious</a></h1>
                    <aside>
                        <p><time datetime="2013-03-14">
                            Posted on 2013-03-14
                        </time>
                        by preaction</p>
                    </aside>
                    <div class="alert alert-info">
                        <p>Originally posted as:</p>
                        <ul>
                            <li><a class="alert-link" href="http://blogs.perl.org/users/preaction/2013/03/chicagopm---mojolicious.html">
                                <em>Chicago.PM - Mojolicious</em> on blogs.perl.org.
                            </a></li>
                        </ul>
                    </div>
                </header>
                <p>February's meeting was about the <a href="http://mojolicio.us">Mojolicious Web
Framework</a>. <a href="http://blogs.perl.org/users/joel_berger/">Joel
Berger</a> has written a <a href="https://metacpan.org/module/Galileo">minimal Perl
CMS called Galileo</a>, and agreed to give a
talk about the benefits of Mojolicious.</p>

<p>Best of all, <a href="https://github.com/jberger/MojoliciousIntroduction">the talk itself was written in
Mojolicious</a>! As Joel was
talking, he was able to edit the code and display the results, showing off
various features of Mojolicious like:</p>

<ul>
<li>Websockets</li>
<li>Easy testing (even of websockets)</li>
<li>Helper scripts</li>
<li>Mojo templates</li>
</ul>

<p>There are quite a few interesting parts of Mojolicious that make it worth
giving a look to, and I hope to be able to do so with some web projects that
have been sitting in my queue for a while (I wrote a nice ticket tracker with
AngularJS, but the backend is Python, I'd like to fix that glaring mistake).</p>

            </article>
            <article>
                <header>
                    <h1><a href="/blog/2012/11/04/testing-is-a-feature-of-your-service.html">Testing is a Feature of Your Service</a></h1>
                    <aside>
                        <p><time datetime="2012-11-04">
                            Posted on 2012-11-04
                        </time>
                        by preaction</p>
                    </aside>
                    <div class="alert alert-info">
                        <p>Originally posted as:</p>
                        <ul>
                            <li><a class="alert-link" href="http://blogs.perl.org/users/preaction/2012/11/testing-is-a-feature-of-your-service.html">
                                <em>Testing is a Feature of Your Service</em> on blogs.perl.org.
                            </a></li>
                        </ul>
                    </div>
                </header>
                <p>My job at Bank of America consists largely of data collection and storage. To
collect data in Perl, I have to write XS modules to interface with the
vendor-supplied native libraries. Because I want to know my code works, my XS
modules come with robust test suites, testing that everything works correctly.</p>

<p>Since the XS module was intended to be used by other, larger systems, I decided
to help those larger systems test their dependency on my module: I included a
<a href="http://search.cpan.org/perldoc?Test::MockObject">Test::MockObject</a> that mocked
my module's interface. By using my test module, the tests can try some data and
see if their code works.</p>

<p>But the hardest part to test is always the failures. How do they test if the
news service goes down in the middle of a data pull? How about if it goes down
between data pulls but still inside the same process? How do they test if the
user has input an invalid ID for data?</p>

<hr />

<p>To help them write good error-checking and recovery, I added specific
Test::MockObjects that return failure conditions. Want to know what happens if
an ID is invalid? Use the Test::Feed::InvalidId mock API. Want to know what
happens if the feed goes down in the middle of a process? Use the
Test::Feed::RandomDisconnect mock API.</p>

<p>By providing these mock objects, users can write more robust code more simply.
Then, in the eventuality that the service fails, they know exactly what their
code won't do: Wake them up at 3 in the morning because of an unexpected,
unhandled error. These mock objects don't even need an external connection to
operate, so they can be as fast as possible.</p>

<p>Unfortunately, this is a limited solution that covers only what I know about.
If the service changes, or has an error I didn't cover, the code still fails.
For this reason, for the web services I build, I build in explicit ways to get
errors. When the service itself gives the exact error output it gives in
exceptional circumstances, it can be tested and handled. Instead of a mock
service, it's the real service (perhaps on a dev system), with real input,
returning a real (but desired) error message.</p>

<p>By providing as much help as possible to the users of my code, I can make sure
they can create robust applications that make their own users happy. By helping
users respond to and deal with the error conditions of my code, I can cut down
on the support requests and bug reports. Being proactive about testing helps
everyone write better code.</p>

            </article>
            <article>
                <header>
                    <h1><a href="/blog/2012/10/28/chicago.pm-report-scripting-git-with-perl.html">Chicago.PM - Scripting Git With Perl</a></h1>
                    <aside>
                        <p><time datetime="2012-10-28">
                            Posted on 2012-10-28
                        </time>
                        by preaction</p>
                    </aside>
                    <div class="alert alert-info">
                        <p>Originally posted as:</p>
                        <ul>
                            <li><a class="alert-link" href="http://blogs.perl.org/users/preaction/2012/10/chicagopm-report---scripting-git-with-perl.html">
                                <em>Chicago.PM - Scripting Git With Perl</em> on blogs.perl.org.
                            </a></li>
                        </ul>
                    </div>
                </header>
                <p>This month's presentation was on the
<a href="http://search.cpan.org/dist/Git-Repository/">Git::Repository</a> Perl module,
given by me. In both my jobs, I use the Git::Repository module to automate
releases.</p>

<hr />

<p>At <a href="http://www.doublecluepon.com">Double Cluepon</a>, I use it to create the
release packages based on tagged commits, so that releasing our software is
exactly: <code>git tag vX.X.X &amp;&amp; git push --tags</code>. A Perl script builds every package
and then pushes them to our update server, where the game will check for a new
release.</p>

<p>At Bank of America, we use it to combine our 20-30 Perl distributions into a
single release. Using git submodules, we have a "release repository" that holds
references to all the modules for each team's releases (some are team-specific,
others are shared between teams). A Perl script manages the submodules,
determines when the submodule refs need to be updated, tags and branches for
each release, and finally builds and installs our modules using
<a href="http://search.cpan.org/dist/Module-Build/">Module::Build</a> and
<a href="http://search.cpan.org/dist/local-lib/">local::lib</a>.</p>

<p>All this Git stuff gave me some ideas for possible useful code I can release,
perhaps leading to me finally recovering my CPAN ID.</p>

<p><a href="http://preaction.github.com/Perl/Scripting-Git.html">The slides for my Scripting Git With Perl
talk</a></p>

<p><a href="https://gist.github.com/3943302">The code for the script that automatically builds releases tagged like
"vX.X.X"</a></p>

            </article>
            <article>
                <header>
                    <h1><a href="/blog/2012/10/22/using-moosex-types-to-inflate-config-values.html">Using MooseX::Types to Inflate Config Values</a></h1>
                    <aside>
                        <p><time datetime="2012-10-22">
                            Posted on 2012-10-22
                        </time>
                        by preaction</p>
                    </aside>
                    <div class="alert alert-info">
                        <p>Originally posted as:</p>
                        <ul>
                            <li><a class="alert-link" href="http://blogs.perl.org/users/preaction/2012/10/using-moosextypes-to-inflate-config-values.html">
                                <em>Using MooseX::Types to Inflate Config Values</em> on blogs.perl.org.
                            </a></li>
                        </ul>
                    </div>
                </header>
                <p>For a large application, configuration files become a necessity. They help
flexible code be used in multiple instances across multiple modules. But they
are, for the most part, only data structures, which can be a problem if the
configured object is expecting another configured object.</p>

<hr />

<pre><code>package FakeRepository;

use Moose;
use TimeSeries;
has timeseries =&gt; (
        is =&gt; 'rw',
        isa =&gt; 'TimeSeries',
        required =&gt; 1,
);

package TimeSeries;

use Moose;
has dates =&gt; (
        is =&gt; 'rw',
        isa =&gt; 'HashRef[Number]', # Date =&gt; Value pairs
        default =&gt; sub { {} },
);
</code></pre>

<p>Here we have a FakeRepository that requires a TimeSeries object. Certainly,
this is where a Dependency Injection framework could step in and inject the
required TimeSeries. The drawback is the indirection: The two configured
objects are completely separate, joined only by the reference, like so:</p>

<pre><code># dependency.yml
- service:
        name: 'test_repo'
        class: 'FakeRepository'
        constructor_args:
                timeseries: { ref: test_data }

- service:
        name: 'test_data'
        class: 'TimeSeries'
        constructor_args:
                dates:
                        2012-01-01: 1.56
                        2012-01-02: 1.69
                        2012-01-03: 1.45
</code></pre>

<p>So here, we define two services (objects), test_repo and test_data, and
test_repo uses test_data to fill its timeseries attribute. test_data fills
in its dates attribute directly from the configuration file.</p>

<p>This works great if test_data is needed by more than just test_repo. It also
works fine as-is, the dependency injection framework does the work. But what if
we wanted to specify the timeseries value directly, instead of indirectly?</p>

<p>Moose's typing system allows us to do just that. By creating a custom type with
a coercion from the data structure in our configuration file, we can create the
dependency that our test_repo needs.</p>

<pre><code>package My::Types;

use MooseX::Types qw( HashRef Number );
use TimeSeries;

# declare our TimeSeries class as a type
class_type TimeSeriesType;
# coerce a TimeSeries from a hash of date =&gt; value pairs
coerce TimeSeriesType, from HashRef[Number], via sub {
        # coercions put the value to be coerce in $_
        return TimeSeries-&gt;new( data =&gt; $_ );
};
</code></pre>

<p>Once we have our new custom types, we must use them in our package.</p>

<pre><code>package FakeRepository;

use Moose;
use My::Types qw( TimeSeriesType );

has timeseries =&gt; qw(
        is =&gt; 'rw',
        isa =&gt; TimeSeriesType,  # Not quoted!
        coerce =&gt; 1,                    # Activate coercion powers!
        required =&gt; 1,
);
</code></pre>

<p>Now, we can configure our TimeSeries directly from our configuration file,
without indirection.</p>

<pre><code># dependency.yml
- service:
        name: 'test_repo'
        class: 'FakeRepository'
        constructor_args:
                timeseries:
                        2012-01-01: 1.56
                        2012-01-02: 1.69
                        2012-01-03: 1.45
</code></pre>

<p>Moose will create the object for us using our defined coercion.</p>

<p>There are other ways to solve this: Enhance the Dependency Injection framework
to allow anonymous objects (instead of providing a ref: to an object, provide a
full object definition with class: and constructor_args:), but having these
coercions in place also helps when writing test code:</p>

<pre><code>use Test::More;
use FakeRepository;
my $repo = FakeRepository-&gt;new(
        timeseries =&gt; {
                '2012-01-01' =&gt; 1.56,
                '2012-01-02' =&gt; 1.69,
                '2012-01-03' =&gt; 1.45,
        },
);
</code></pre>

<p>No need to increase the apparent coverage of the test by including the
TimeSeries class, we never have to refer to it at all. No need to lock the
interface to a specific TimeSeries class (if that's a desired goal of the
project), the coercion takes care of creating the actual object used.</p>

<p>Coercions are a powerful feature. I've used them to build complicated trees
from arrays of arrays (more on that later), and I've used them to simply
force-uppercase a string so that Log4perl would do its job. Coercions are one
more very useful tool in a robust toolbox.</p>

            </article>
        </main>
        <ul class="pager">
            <li class="previous ">
                <a rel="next" href="/blog/page-3.html">&larr; Older</a>
            </li>
            <li class="next ">
                <a rel="prev" href="/blog/index.html">Newer &rarr;</a>
            </li>
        </ul>
    </div>

    <div class="col-md-3">
        <nav id="tags">
            <h1>Tags</h1>
            <ul class="list-inline">
                <li><a href="/blog/tag/chicago.pm/index.html">chicago.pm</a></li>
                <li><a href="/blog/tag/error/index.html">error</a></li>
                <li><a href="/blog/tag/git/index.html">git</a></li>
                <li><a href="/blog/tag/moose/index.html">moose</a></li>
                <li><a href="/blog/tag/mysql/index.html">mysql</a></li>
                <li><a href="/blog/tag/perl/index.html">perl</a></li>
                <li><a href="/blog/tag/rants/index.html">rants</a></li>
                <li><a href="/blog/tag/software/index.html">software</a></li>
                <li><a href="/blog/tag/webgui/index.html">webgui</a></li>
                <li><a href="/blog/tag/xs/index.html">xs</a></li>
            </ul>
        </nav>
        <h2>Feeds</h2>
            <a href="/blog/index.atom" rel="alternate" type="application/atom+xml">
                Atom
            </a>
            <a href="/blog/index.rss" rel="alternate" type="application/rss+xml">
                RSS
            </a>
    </div>

</div>

        </div>
    </body>
</html>
